<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: views/GraphView.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: views/GraphView.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/* jshint jquery:true, devel: true */
/* global isomatic, d3, Backbone, _ */

(function(isomatic) {
    "use strict";

    /**
     * Graph View
     *
     * @type {*|void|Object}
     */
    isomatic.views.GraphView = Backbone.View.extend({

        /**
         * Init Graph
         */
        initialize: function(){

            // Cache jQuery Selectors
            this.$display = $('#display');
            this.$sidebar = $('#sidebar');

            this.render();

            // TODO: Refresh Graphic Method & Refresh Data Method

            this.newVisualisation(isomatic.options.ui.get("aspectRatio"));

        },

        /**
         * Render Graph Element
         */
        render: function(){
            this.$el.html('&lt;div id="graph">&lt;/div>');
        },

        /**
         * Manage Events
         */
        events: {
            "click #graph": "graphClick"
        },

        /**
         * If the graph is clicked, close all Overlays
         */
        graphClick: function() {
            window.location = '#home';
        },

        /**
         * Creates a new Visualisation
         */
        newVisualisation: function(aspectRatio) {

            console.log('GraphView.newVisualisation(' + aspectRatio + ');');

            // Calculate Width and Height from Aspect Ratio
            isomatic.options.ui.set("aspectRatio", aspectRatio);
            isomatic.data.meta.attributes.width = this.$display.width();
            isomatic.data.meta.attributes.height = Math.round(isomatic.data.meta.attributes.width / aspectRatio);

            // Sets height of the Drawing Area according to aspect ratio
            this.$display.height(isomatic.data.meta.attributes.height);
            this.$sidebar.height(isomatic.data.meta.attributes.height);

        },

        /**
         * Precalculates the visual Layout. Recommends some options like Icon-Size.
         * Stores the data into the isomatic.data.meta.attributes Object
         */
        precalculate: function() {
            "use strict";

            console.log('GraphView.precalculate();');

            var iconsPerRow = [];

            for (var i = 0; i &lt; isomatic.data.processed.length; i++) {

                var obj = isomatic.data.processed[i];

                if (!iconsPerRow[obj.row]) {
                    iconsPerRow[obj.row] = 1;
                } else {
                    iconsPerRow[obj.row] += 1;
                }

            }

            isomatic.data.meta.attributes.iconsPerRow = iconsPerRow;
            isomatic.data.meta.attributes.maxIconsPerRow = d3.max(iconsPerRow);

            // Calculate Base Scale for Icons depending on biggest Row. (Fit to width)
            var widthLeft = isomatic.data.meta.attributes.width -
                (isomatic.data.meta.attributes.maxIconsPerRow * isomatic.options.ui.get("iconHorizontalMargin")) -
                2 * isomatic.options.ui.get("outerMargin");
            isomatic.data.meta.attributes.baseScale = widthLeft / (isomatic.data.meta.attributes.maxIconsPerRow * 32);

        },

        /**
         * Prepares the Drawing
         * Creates and prepares SVG Canvas
         * Creates and prepares the Isotype Layout
         */
        prepareDrawing: function() {

            console.log('GraphView.prepareDrawing();');

            $('#graph').html('');

            ///////////////////////////////////////
            // Visualisation Options             //
            ///////////////////////////////////////

            // Set Visualisation Options
            this.isotypeLayout = d3.layout.isotype()
                .roundDown(isomatic.options.ui.get("roundDown"))
                .roundUp(isomatic.options.ui.get("roundUp"))
                .scale(isomatic.options.ui.get("scale"))
            ;

            ///////////////////////////////////////
            // Create SVG Container              //
            ///////////////////////////////////////

            this.svg = d3.select("#graph").append("svg")
                .attr("width",isomatic.data.meta.attributes.width)
                .attr("height", isomatic.data.meta.attributes.height)
                .append("g")
                .attr("id", "isotype")
            ;
        },

        /**
         * Draws Isotype Graphic
         *
         * TODO: Line Return if overflowing on the right side
         */
        drawIsotype: function() {

            console.log('GraphView.drawIsotype();');

            ///////////////////////////////////////
            // Draw Data                         //
            ///////////////////////////////////////

            if (isomatic.data.raw) {

                var finalSize = isomatic.data.meta.attributes.baseScale * isomatic.options.internal.defaultIconSize;

                var g =this.svg.selectAll(".icon")
                        .data(isomatic.data.processed)
                        .enter()
                        .append("g")
                        .attr("class", "icon")
                        .attr("transform", function(d) {

                            var x = d.pos * (finalSize + isomatic.options.ui.get("iconHorizontalMargin")) + isomatic.options.ui.get("outerMargin");
                            var y = d.row * (finalSize + isomatic.options.ui.get("rowMargin")) + isomatic.options.ui.get("outerMargin");

                            var scale = isomatic.data.meta.attributes.baseScale * d.size;

                            // If Icon is drawn smaller than full-size, center it
                            if (d.size &lt; 1) {
                                x += (finalSize / 2) * (1 - d.size);
                                y += (finalSize / 2) * (1 - d.size);
                            }

                            // If Icon is drawn outside of Canvas give a warning
                            if (y > isomatic.data.meta.attributes.height || x >isomatic.data.meta.attributes.width) {
                                isomatic.message('warning', '&lt;strong>Warning: &lt;/strong>The generated Graphic is bigger than its Canvas!');
                            }

                            return 'translate(' + x + ', ' + y + ') scale(' + scale + ')';

                        })
                        .html(function(d) {

                            var category, name;

                            if (isomatic.options.ui.get("iconize") === 'row') {
                                category = isomatic.options.ui.get("iconMap")[d.row].category;
                                name = isomatic.options.ui.get("iconMap")[d.row].name;
                            } else {
                                category = isomatic.options.ui.get("iconMap")[d.col - 1].category;
                                name = isomatic.options.ui.get("iconMap")[d.col - 1].name;
                            }

                            return isomatic.icons[category].icons[name].svg;
                        })
                        .attr("fill", function(d) {
                            if (isomatic.options.ui.get("colorize") === 'row') {
                                return '#' + isomatic.options.ui.get("colorMap")[d.row];
                            } else {
                                return '#' + isomatic.options.ui.get("colorMap")[d.col - 1];
                            }
                        })
                    ;

            } else {
                isomatic.message('error', 'No Data loaded!');
            }

        },

        /**
         * Draws Legend Overlay
         * TODO: Not completely implemented yet
         */
        drawLegend: function() {

            console.log('GraphView.drawLegend();');

            var legendText = '1 : ' +this.printScale(isomatic.options.ui.get("scale"));

            var legend =this.svg.append("g")
                .style("text-anchor", "start")
                .attr("transform", "translate(" + isomatic.options.ui.get("outerMargin") + ", " + (isomatic.data.meta.attributes.height - 2 * isomatic.options.ui.get("outerMargin")) + ")");

            legend.append("text")
                .attr("class", "legend")
                .text(legendText)
                .attr("fill", "#999999")
            ;
        },

        /**
         * Pretty prints the Scale (for use with the Legend and the UI)
         *
         * http://stackoverflow.com/a/2901298/776425
         *
         * @param scale
         * @returns {string}
         */
        printScale: function(scale) {
            return scale.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

    });

}(isomatic));

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Global</h3><ul><li><a href="global.html#analyze">analyze</a></li><li><a href="global.html#applyColor">applyColor</a></li><li><a href="global.html#colorizeColumn">colorizeColumn</a></li><li><a href="global.html#colorizeRow">colorizeRow</a></li><li><a href="global.html#columns">columns</a></li><li><a href="global.html#drawIsotype">drawIsotype</a></li><li><a href="global.html#drawLegend">drawLegend</a></li><li><a href="global.html#embedData">embedData</a></li><li><a href="global.html#events">events</a></li><li><a href="global.html#exportJSON">exportJSON</a></li><li><a href="global.html#exportSVG">exportSVG</a></li><li><a href="global.html#focusTextarea">focusTextarea</a></li><li><a href="global.html#graphClick">graphClick</a></li><li><a href="global.html#home">home</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#isomatic">isomatic</a></li><li><a href="global.html#max">max</a></li><li><a href="global.html#min">min</a></li><li><a href="global.html#newVisualisation">newVisualisation</a></li><li><a href="global.html#precalculate">precalculate</a></li><li><a href="global.html#prepareDrawing">prepareDrawing</a></li><li><a href="global.html#printScale">printScale</a></li><li><a href="global.html#process">process</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#rows">rows</a></li><li><a href="global.html#selectColorpalette">selectColorpalette</a></li><li><a href="global.html#submitData">submitData</a></li><li><a href="global.html#sum">sum</a></li><li><a href="global.html#tablePreview">tablePreview</a></li><li><a href="global.html#triggerUi">triggerUi</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Wed Jan 15 2014 13:58:16 GMT+0100 (MEZ)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
